<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HTORI ERP Realtime - v1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root{--nav-w:220px;--accent:#1F3C88;--bg:#f2f5f8;--card:#fff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:#222}
    .site-header{height:60px;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:fixed;left:0;right:0;top:0;z-index:40}
    .layout{display:flex;padding-top:60px;min-height:calc(100vh - 60px)}
    .sidebar{width:var(--nav-w);background:#11151a;color:#fff;padding:12px;}
    .menu-btn{display:block;width:100%;padding:10px;background:transparent;border:0;color:#ddd;text-align:left;border-radius:6px}
    .menu-btn.active{background:#222}
    .content{flex:1;padding:20px}
    .card{background:#fff;border-radius:8px;padding:14px;margin-bottom:14px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .modal-backdrop{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.25);z-index:999}
    .modal-card{width:420px;background:#fff;padding:20px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,.25)}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e6e9ec;padding:8px;text-align:left}
  </style>

  <!-- Firebase & XLSX -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div style="font-weight:700">HTORI ERP Realtime</div>
    <div>
      User: <span id="user-name">Guest</span> (<span id="user-role">viewer</span>)
      <button id="logoutBtn" class="hidden">Logout</button>
    </div>
  </header>

  <!-- LAYOUT -->
  <div class="layout">
    <aside class="sidebar">
      <ul id="menuList"></ul>
    </aside>

    <main id="content" class="content"></main>
  </div>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal-backdrop">
    <div class="modal-card">
      <h2 style="text-align:center;margin-bottom:12px">HTORI ERP LOGIN</h2>

      <label>ID</label>
      <input id="loginId" placeholder="admin">

      <label style="margin-top:8px">Password</label>
      <input id="loginPw" type="password" placeholder="1234">

      <div style="text-align:right;margin-top:12px">
        <button id="demoBtn">Demo</button>
        <button id="loginBtn">Login</button>
      </div>

      <p style="margin-top:8px;color:#666;font-size:13px">첫 실행 기본계정: admin / 1234</p>
    </div>
  </div>

  <!-- Templates -->
  <template id="tpl-dashboard">
    <h1>Dashboard</h1>
    <div class="card">
      <h3>Overview</h3>
      <p class="muted">Summary widgets will be placed here.</p>
    </div>
  </template>

  <template id="tpl-settings">
    <h1>Settings</h1>
    <div class="card">
      <label>Default language</label>
      <select id="settingDefaultLang">
        <option>EN</option><option>KR</option><option>ID</option>
      </select>

      <label style="margin-top:12px">Menu order</label>
      <input id="settingMenuOrder" placeholder="dashboard,employees,settings">

      <div style="margin-top:12px;text-align:right">
        <button id="saveSettingsBtn">Save</button>
      </div>
    </div>
  </template>

  <!-- MAIN SCRIPT -->
<script>
/* ===============================
   Firebase CONFIG
================================= */
const firebaseConfig = {
  apiKey: "AIzaSyDwiTlPtoXraEtA7TzTctdH6DJS6gdSEGQ",
  authDomain: "htori-erp-3c22b.firebaseapp.com",
  databaseURL: "https://htori-erp-3c22b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "htori-erp-3c22b",
  storageBucket: "htori-erp-3c22b.firebasestorage.app",
  messagingSenderId: "975336397666",
  appId: "1:975336397666:web:ae45a471e51bf71e9dea3b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===============================
   GLOBAL STATE
================================= */
let currentUser = null;
let lang = "EN";

const content = document.getElementById("content");
const menuList = document.getElementById("menuList");
const loginModal = document.getElementById("loginModal");
const logoutBtn = document.getElementById("logoutBtn");
const loginBtn = document.getElementById("loginBtn");
const demoBtn = document.getElementById("demoBtn");

/* ===============================
   Ensure ADMIN
================================= */
(async function ensureAdmin(){
  const snap = await db.ref("employees").once("value");
  if(!snap.exists()){
    await db.ref("employees").push({
      id:"admin", pw:"1234", role:"master", name:"Master"
    });
    console.log("Admin created");
  } else {
    console.log("Admin exists");
  }
})();

/* ===============================
   Login Logic
================================= */
loginBtn.addEventListener("click", login);
demoBtn.addEventListener("click", ()=>{ currentUser={id:"guest",role:"viewer"}; onLogin(); });

function login(){
  const id = document.getElementById("loginId").value.trim();
  const pw = document.getElementById("loginPw").value.trim();

  db.ref("employees").once("value").then(s=>{
    const list = Object.values(s.val() || {});
    const user = list.find(u=>u.id===id && u.pw===pw);
    if(!user){ alert("Login failed"); return; }
    currentUser = user;
    onLogin();
  });
}

function onLogin(){
  document.getElementById("user-name").innerText = currentUser.name || currentUser.id;
  document.getElementById("user-role").innerText = currentUser.role || "viewer";
  loginModal.classList.add("hidden");
  logoutBtn.classList.remove("hidden");

  renderMenu();
  showPage("dashboard");
}

logoutBtn.addEventListener("click", ()=>{
  currentUser = null;
  loginModal.classList.remove("hidden");
});

/* ===============================
   Menu / Page System
================================= */
function renderMenu(){
  const menus = ["dashboard","employees","settings"];
  menuList.innerHTML = "";
  menus.forEach(key=>{
    const li = document.createElement("li");
    li.innerHTML = `<button class="menu-btn" data-key="${key}">${key}</button>`;
    li.querySelector("button").addEventListener("click", ()=> showPage(key));
    menuList.appendChild(li);
  });
}

function showPage(key){
  if(key==="dashboard") return renderDashboard();
  if(key==="settings") return renderSettings();
  content.innerHTML = `<div class="card"><h3>${key}</h3><p>Page not implemented.</p></div>`;
}

/* ===============================
   Page Renderers
================================= */
function renderDashboard(){
  content.innerHTML = "";
  content.appendChild(document.getElementById("tpl-dashboard").content.cloneNode(true));
}

function renderSettings(){
  content.innerHTML = "";
  content.appendChild(document.getElementById("tpl-settings").content.cloneNode(true));

  document.getElementById("saveSettingsBtn").addEventListener("click", ()=>{
    alert("Settings saved");
  });
}

</script>
</body>
</html>
