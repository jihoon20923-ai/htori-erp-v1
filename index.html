<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HTORI ERP Realtime - v1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root{--nav-w:220px;--accent:#1F3C88;--bg:#f2f5f8;--card:#fff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#222}
    .site-header{height:60px;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:fixed;left:0;right:0;top:0;z-index:40}
    .layout{display:flex;padding-top:60px;min-height:calc(100vh - 60px)}
    .sidebar{width:var(--nav-w);background:#111;color:#fff;padding:12px}
    .menu-list{list-style:none;padding:0;margin:0}
    .menu-btn{width:100%;text-align:left;padding:10px;border:0;background:none;color:#ddd;cursor:pointer}
    .menu-btn.active{background:#333}
    .content{flex:1;padding:20px}
    .card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .hidden{display:none}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;z-index:100}
    .modal-card{background:#fff;padding:20px;border-radius:10px;width:320px}
    label{display:block;margin-bottom:4px;font-weight:bold}
    input{width:100%;padding:8px;margin-bottom:8px}
  </style>
</head>

<body>

<header class="site-header">
  <div>HTORI ERP Realtime v1</div>
  <div>
    <span id="userInfo">Guest</span>
    <button id="logoutBtn" class="btn hidden">Logout</button>
  </div>
</header>

<div class="layout">
  <aside class="sidebar">
    <ul id="menuList" class="menu-list"></ul>
  </aside>
  <main id="content" class="content"></main>
</div>

<!-- LOGIN -->
<div id="loginModal" class="modal-backdrop">
  <div class="modal-card">
    <h3>LOGIN</h3>
    <label>ID</label>
    <input id="loginId" value="admin">
    <label>Password</label>
    <input id="loginPw" type="password" value="1234">
    <button id="loginBtn" class="btn primary">Login</button>
  </div>
</div>

<!-- Firebase SDK (â— ë°˜ë“œì‹œ JSë³´ë‹¤ ë¨¼ì €) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ===============================
   Firebase Init
================================ */
const firebaseConfig = {
  apiKey: "AIzaSyDwiTlPtoXraEtA7TzTctdH6DJS6gdSEGQ",
  authDomain: "htori-erp-3c22b.firebaseapp.com",
  databaseURL: "https://htori-erp-3c22b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "htori-erp-3c22b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
console.log("ðŸ”¥ Firebase OK");

/* ===============================
   Auto create admin
================================ */
db.ref("employees").once("value").then(s=>{
  if(!s.exists()){
    db.ref("employees").push({
      id:"admin", pw:"1234", name:"Master", role:"master"
    });
    console.log("âœ… admin created");
  }
});

/* ===============================
   State
================================ */
let currentUser = null;
const menuList = document.getElementById("menuList");
const content = document.getElementById("content");
const loginModal = document.getElementById("loginModal");

/* ===============================
   Menu
================================ */
function renderMenu(){
  menuList.innerHTML = "";
  ["dashboard","employees","settings"].forEach(k=>{
    const li = document.createElement("li");
    li.innerHTML = `<button class="menu-btn" data-key="${k}">${k}</button>`;
    li.querySelector("button").onclick = ()=>showPage(k);
    menuList.appendChild(li);
  });
}

function showPage(k){
  document.querySelectorAll(".menu-btn").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.menu-btn[data-key="${k}"]`)?.classList.add("active");

  if(k==="dashboard"){
    content.innerHTML = `<div class="card"><h2>Dashboard</h2></div>`;
  }
  if(k==="employees"){
    content.innerHTML = `<div class="card"><h2>Employees</h2></div>`;
  }
  if(k==="settings"){
    content.innerHTML = `<div class="card"><h2>Settings</h2></div>`;
  }
}

/* ===============================
   Login
================================ */
document.getElementById("loginBtn").onclick = ()=>{
  const id = loginId.value.trim();
  const pw = loginPw.value.trim();

  db.ref("employees").once("value").then(s=>{
    const users = Object.values(s.val()||{});
    const u = users.find(x=>x.id===id && x.pw===pw);
    if(!u) return alert("LOGIN FAIL");

    currentUser = u;
    loginModal.classList.add("hidden");
    document.getElementById("userInfo").innerText = u.name;
    document.getElementById("logoutBtn").classList.remove("hidden");
    renderMenu();
    showPage("dashboard");
  });
};

document.getElementById("logoutBtn").onclick = ()=>{
  location.reload();
};
</script>

</body>
</html>
