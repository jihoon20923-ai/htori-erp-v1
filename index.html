<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>HTORI Realtime ERP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:12px;display:flex;justify-content:space-between}
aside{width:220px;background:#020617;height:100vh;padding:10px}
main{flex:1;padding:15px}
button,input,select{padding:8px;border-radius:6px;border:1px solid #333;background:#020617;color:#fff}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #333;padding:6px;text-align:center}
.page{display:none}
.layout{display:flex}
</style>
</head>

<body>

<!-- ✅ LOGIN -->
<div id="loginBox">
  <h2 style="padding:20px">HTORI ERP LOGIN</h2>
  <div style="padding:20px">
    <input id="loginId" placeholder="ID"><br><br>
    <input id="loginPw" type="password" placeholder="Password"><br><br>
    <button onclick="login()">LOGIN</button>
  </div>
</div>

<!-- ✅ ERP -->
<div id="erp" style="display:none">

<header>
  <b>HTORI REALTIME ERP</b>
  <select id="lang" onchange="setLang(this.value)">
    <option value="ko">한국어</option>
    <option value="en">EN</option>
    <option value="id">INDO</option>
  </select>
</header>

<div class="layout">
<aside id="menu"></aside>
<main>

<div id="page-dashboard" class="page"><h2>Dashboard</h2></div>

<div id="page-employee" class="page">
<h2>직원 등록</h2>
<input id="eId" placeholder="ID">
<input id="ePw" placeholder="PW">
<input id="eName" placeholder="Name">
<select id="eRole">
  <option value="master">Master</option>
  <option value="sales">Sales</option>
  <option value="production">Production</option>
</select>
<button onclick="addEmployee()">등록</button>

<table>
<thead><tr><th>ID</th><th>Name</th><th>Role</th></tr></thead>
<tbody id="empBody"></tbody>
</table>
</div>

<div id="page-stock" class="page">
<h2>재고</h2>
<input id="sCode" placeholder="Code">
<input id="sQty" type="number" placeholder="Qty">
<button onclick="addStock()">입고</button>

<table>
<thead><tr><th>Code</th><th>Qty</th></tr></thead>
<tbody id="stockBody"></tbody>
</table>
</div>

<div id="page-order" class="page">
<h2>주문</h2>
<input id="oNo" placeholder="Order No">
<input id="oProduct" placeholder="Product">
<input id="oQty" type="number" placeholder="Qty">
<button onclick="addOrder()">주문 입력</button>

<table>
<thead><tr><th>No</th><th>Product</th><th>Qty</th></tr></thead>
<tbody id="orderBody"></tbody>
</table>
</div>

</main>
</div>
</div>

<script>
// ✅ Firebase 연결
var firebaseConfig = {
  apiKey: "AIzaSyDwiTlPtoXraEtA7TzTctdH6DJS6gdSEGQ",
  authDomain: "htori-erp-3c22b.firebaseapp.com",
  databaseURL: "https://htori-erp-3c22b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "htori-erp-3c22b",
  storageBucket: "htori-erp-3c22b.firebasestorage.app",
  messagingSenderId: "975336397666",
  appId: "1:975336397666:web:ae45a471e51bf71e9dea3b"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

// ✅ 공통 함수
function saveData(key,val){db.ref(key).set(val);}
function listenData(key,cb){db.ref(key).on("value",s=>cb(s.val()||[]));}

// ✅ 최초 관리자 생성
listenData("employees", list=>{
if(list.length===0){
list.push({id:"admin",pw:"1234",name:"Master",role:"master"});
saveData("employees",list);
}
});

// ✅ 로그인
let currentUser=null;
function login(){
listenData("employees", list=>{
const found=list.find(e=>e.id===loginId.value && e.pw===loginPw.value);
if(!found){alert("로그인 실패");return;}
currentUser=found;
loginBox.style.display="none";
erp.style.display="block";
buildMenu();
showPage("dashboard");
});
}

// ✅ 메뉴 권한
function buildMenu(){
menu.innerHTML="";
const map={
master:["dashboard","employee","stock","order"],
sales:["dashboard","order"],
production:["dashboard","stock"]
};
map[currentUser.role].forEach(p=>{
const b=document.createElement("button");
b.innerText=p;
b.onclick=()=>showPage(p);
menu.appendChild(b);
});
}

function showPage(p){
document.querySelectorAll(".page").forEach(x=>x.style.display="none");
document.getElementById("page-"+p).style.display="block";
}

// ✅ 직원
function addEmployee(){
listenData("employees", list=>{
if(list.find(x=>x.id===eId.value)){alert("중복 ID");return;}
list.push({id:eId.value,pw:ePw.value,name:eName.value,role:eRole.value});
saveData("employees",list);
});
}

listenData("employees", list=>{
empBody.innerHTML="";
list.forEach(e=>{
empBody.innerHTML+=`<tr><td>${e.id}</td><td>${e.name}</td><td>${e.role}</td></tr>`
});
});

// ✅ 재고
function addStock(){
listenData("stock", list=>{
list.push({code:sCode.value,qty:Number(sQty.value)});
saveData("stock",list);
});
}

listenData("stock", list=>{
stockBody.innerHTML="";
list.forEach(s=>{
stockBody.innerHTML+=`<tr><td>${s.code}</td><td>${s.qty}</td></tr>`
});
});

// ✅ 주문
function addOrder(){
listenData("orders", list=>{
list.push({no:oNo.value,product:oProduct.value,qty:oQty.value});
saveData("orders",list);
});
}

listenData("orders", list=>{
orderBody.innerHTML="";
list.forEach(o=>{
orderBody.innerHTML+=`<tr><td>${o.no}</td><td>${o.product}</td><td>${o.qty}</td></tr>`
});
});

// ✅ 다국어 기본 틀
function setLang(l){
alert("언어 변경: "+l+" (UI 확장 가능)");
}
</script>

</body>
</html>
